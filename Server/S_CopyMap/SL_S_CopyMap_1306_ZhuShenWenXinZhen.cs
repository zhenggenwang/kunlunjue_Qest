//==================================================================================
//注：所有脚本开头，均需注明本脚本的大致说明文字
//
//
//诛神问心阵
//==================================================================================

//------------------ID------------坐标--------------朝向-大小-仇恨组---
$MonsterRecord[1]="413031006;-179.888 187.591 100.579;90;1 1 1;1"; //阵卒
$MonsterRecord[2]="413031006;-179.798 175.358 100.555;90;1 1 1;1"; //阵卒
$MonsterRecord[3]="413031006;-180.017 162.971 100.555;90;1 1 1;1"; //阵卒
$MonsterRecord[4]="413031006;-179.769 150.713 100.555;90;1 1 1;1"; //阵卒
$MonsterRecord[5]="413031006;-179.441 138.494 100.557;90;1 1 1;1"; //阵卒
$MonsterRecord[6]="413031005;-196.063 138.292 100.608;90;1 1 1;1"; //车
$MonsterRecord[7]="413031004;-198.059 144.353 100.570;90;1 1 1;1"; //马
$MonsterRecord[8]="413031003;-198.233 150.744 100.613;90;1 1 1;1"; //象
$MonsterRecord[9]="413031002;-198.059 156.903 100.570;90;1 1 1;1"; //仕
$MonsterRecord[10]="413031001;-197.872 163.137 100.555;90;1 1 1;1"; //将
$MonsterRecord[11]="413031002;-198.116 169.415 100.584;90;1 1 1;1"; //仕
$MonsterRecord[12]="413031003;-198.123 175.411 100.585;90;1 1 1;1"; //象
$MonsterRecord[13]="413031004;-198.042 181.917 100.565;90;1 1 1;1"; //马
$MonsterRecord[14]="413031005;-196.168 187.630 100.589;90;1 1 1;1"; //车
$MonsterRecord[15]="413031007;-195.968 162.819 100.555;90;1 1 1;2";//心魔1
$MonsterRecord[16]="413031007;-196.302 168.916 100.555;90;1 1 1;2";//心魔2
$MonsterRecord[17]="413031007;-196.101 156.716 100.555;90;1 1 1;2";//心魔3
$MonsterRecord[18]="413031007;-192.387 162.901 100.555;90;1 1 1;2";//心魔4
$MonsterRecord[19]="413031007;-191.883 169.415 100.555;90;1 1 1;2";//心魔5
$MonsterRecord[20]="413031007;-192.202 156.809 100.555;90;1 1 1;2";//心魔6
$MonsterRecord[21]="413031007;-186.055 163.051 100.555;90;1 1 1;2";//心魔7
$MonsterRecord[22]="413031007;-185.953 169.346 100.555;90;1 1 1;2";//心魔8
$MonsterRecord[23]="413031007;-186.114 156.879 100.555;90;1 1 1;2";//心魔9
$MonsterRecord[24]="413031008;-200.063 162.819 100.679;90;1 1 1;2";//阵灵


$SL_ZhuShenWenXinZhen_Item[553000003,1] = "116090081;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000003,2] = "116090082;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000003,3] = "116090083;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000003,4] = "116090084;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000003,5] = "116090085;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000003,6] = "116090071;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000003,7] = "116090072;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000003,8] = "116090073;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000003,9] = "116090074;1;500  ;0;1";

$SL_ZhuShenWenXinZhen_Item[553000004,1] = "116120001;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000004,2] = "116120002;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000004,3] = "116120003;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000004,4] = "116120004;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000004,5] = "116120005;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000004,6] = "116120006;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000004,7] = "116120007;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000004,8] = "116120008;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000004,9] = "116120009;1;500  ;0;1";

$SL_ZhuShenWenXinZhen_Item[553000005,1] = "116120010;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000005,2] = "116120011;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000005,3] = "116120012;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000005,4] = "116120013;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000005,5] = "116120014;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000005,6] = "116120015;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000005,7] = "116120016;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000005,8] = "116120017;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000005,9] = "116120018;1;500  ;0;1";

$SL_ZhuShenWenXinZhen_Item[553000006,1] = "116120019;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000006,2] = "116120020;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000006,3] = "116120021;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000006,4] = "116120022;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000006,5] = "116120023;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000006,6] = "116120024;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000006,7] = "116120025;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000006,8] = "116120026;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000006,9] = "116120027;1;500  ;0;1";

$SL_ZhuShenWenXinZhen_Item[553000007,1] = "116120028;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000007,2] = "116120029;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000007,3] = "116120030;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000007,4] = "116120031;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000007,5] = "116120032;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000007,6] = "116120033;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000007,7] = "116120034;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000007,8] = "116120035;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000007,9] = "116120036;1;500  ;0;1";

$SL_ZhuShenWenXinZhen_Item[553000008,1] = "116120037;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000008,2] = "116120038;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000008,3] = "116120039;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000008,4] = "116120040;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000008,5] = "116120041;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000008,6] = "116120042;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000008,7] = "116120043;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000008,8] = "116120044;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000008,9] = "116120045;1;500  ;0;1";

$SL_ZhuShenWenXinZhen_Item[553000009,1] = "116120046;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000009,2] = "116120047;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000009,3] = "116120048;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000009,4] = "116120049;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000009,5] = "116120050;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000009,6] = "116120051;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000009,7] = "116120052;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000009,8] = "116120053;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000009,9] = "116120054;1;500  ;0;1";

$SL_ZhuShenWenXinZhen_Item[553000010,1] = "116120055;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000010,2] = "116120056;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000010,3] = "116120057;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000010,4] = "116120058;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000010,5] = "116120059;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000010,6] = "116120060;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000010,7] = "116120061;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000010,8] = "116120062;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000010,9] = "116120063;1;500  ;0;1";

$SL_ZhuShenWenXinZhen_Item[553000011,1] = "116120064;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000011,2] = "116120065;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000011,3] = "116120066;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000011,4] = "116120067;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000011,5] = "116120068;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000011,6] = "116120069;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000011,7] = "116120070;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000011,8] = "116120071;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000011,9] = "116120072;1;500  ;0;1";

$SL_ZhuShenWenXinZhen_Item[553000012,1] = "116120073;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000012,2] = "116120074;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000012,3] = "116120075;1;10000;0;1";
$SL_ZhuShenWenXinZhen_Item[553000012,4] = "116120076;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000012,5] = "116120077;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000012,6] = "116120078;1;1000 ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000012,7] = "116120079;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000012,8] = "116120080;1;500  ;0;1";
$SL_ZhuShenWenXinZhen_Item[553000012,9] = "116120081;1;500  ;0;1";
//■■■■【诛神问心阵】■■■■【 NP8C对话】■■■■■■■■■
//■■■■【诛神问心阵】■■■■【区域9触发】■■■■■■■■■
//■■■■【诛神问心阵】■■■■【副本创建触发】■■■■■■■
//■■■■【诛神问心阵】■■■■【玩家进入副本】■■■■■■■
//■■■■【诛神问心阵】■■■■【怪物刷新函数】■■■■■■■
//■■■■【诛神问心阵】■■■■【怪物死亡触发】■■■■■■■
//■■■■【诛神问心阵】■■■■【宝箱采集触发】■■■■■■■


//■■■■【诛神问心阵】■■■■【 NPC对话】■■■■■■■■■
function ZhuShenWenXinZhen_Dialong(%Npc,%Player,%State,%Conv)
{
	%mapID = getsubstr(getzoneid(),0,4);
	%triggerid = %player.gettriggerid();

	%Act4016[0] = getact(%player,4016,0) * 1;
	%Act4016[1] = getact(%player,4016,1) * 1;
	%CopyMapID = %Player.GetLayerId();

	switch (%state)
	{
		case 0:
			%Conv.SetText(600000026);
			if ($SL_ZhuShenWenXinZhen_State_bActive == 1 && %mapID == 1103)
				%Conv.AddOption(600000027,600000027);
			if (%triggerid  == 813030100)
				%Conv.AddOption(600000028,600000028);
		case 600000027:
			%Conv.settype(4);
			if (%player.getlevel() < 40)
			{
				SendOneScreenMessage(2,"你的等级低于40级，无法挑战该副本",%Player);
				SendOneChatMessage($chatMsg_System,"<t>你的等级低于40级，无法挑战该副本。</t>",%Player);
				return;
			}
			if (SvrIsMyselfHasTeam(%Player.getplayerid()))
			{
				SendOneScreenMessage(2,"不允许组队挑战，请离开队伍后再来",%Player);
				SendOneChatMessage($chatMsg_System,"<t>不允许组队挑战，请离开队伍后再来。</t>",%Player);
				return;
			}
			if (%Act4016[0] >= 3)
			{
				SendOneScreenMessage(2,"每天最多允许挑战3次，请明天再来吧",%Player);
				SendOneChatMessage($chatMsg_System,"<t>每天最多允许挑战3次，请明天再来吧。</t>",%Player);
				return;
			}
			%player.flyrecord = 1;
			FlyMeToTheMoon(%Player,11030001,700010000);
		case 600000028:
			%Conv.settype(4);
			if (%Act4016[0] > 3)
				return;
			if (%Player.Deathrecord == 1)
			{
				SendOneScreenMessage(2,"本次挑战已经失败,无法开启",%Player);
				SendOneChatMessage($chatMsg_System,"<t>本次挑战已经失败,无法开启。</t>",%Player);
				return;
			}
			if (%Act4016[1] > 10)
			{
				SendOneScreenMessage(2,"您已经通关了，请明日再来",%Player);
				SendOneChatMessage($chatMsg_System,"<t>您已经通关了，请明日再来。</t>",%Player);
				return;
			}
			%Index = CanSptCreatemonster(%CopyMapID,%Player,%Act4016[1]);
			if (%Index != 1)
			{
				SendOneScreenMessage(2,"当前关卡没用通过，无法开启下一关",%Player);
				SendOneChatMessage($chatMsg_System,"<t>当前关卡没用通过，无法开启下一关。</t>",%Player);
				return;
			}
			SptCreatemonster(%CopyMapID,%Player,%Act4016[1]);
	}
}
function gotocopymap(%Player,%mapid)
{
	GoToNextMap(%Player,%mapid,"");// "<t>传送【诛神问心阵】</t>";
}
//■■■■【诛神问心阵】■■■■【 NPC对话】■■■■■■■■■


//■■■■【诛神问心阵】■■■■【区域触发】■■■■■■■■■
//
// 264053.SetFlyPath( 11030001, 700030000 );
function PlayerEnterTrigger_811030101(%Player,%TriggerId)//副本门口
{
	return;
	if (%player.flyrecord != 1)
		%Player.TransportObject(0,0,-68.0287,-105.253,121.718);
}
//■■■■【诛神问心阵】■■■■【区域触发】■■■■■■■■■

//■■■■【诛神问心阵】■■■■【副本创建触发】■■■■■■■
function SvrCopymapOpen_1306_Trigger(%CopyMapID,%CopymapDataID)
{
	if (!ibobject($MonsterRecord[%CopyMapID,0]))
		$MonsterRecord[%CopyMapID,0] = SpNewNpc3(0,413030001,"-149.205 162.913 100.555",%CopyMapID,0,"1 1 1"); //巨人元神
}
//■■■■【诛神问心阵】■■■■【副本创建触发】■■■■■■■


//■■■■【诛神问心阵】■■■■【玩家进入副本】■■■■■■■
function SptCopymap_OnEnter_1306_Trigger(%CopyMapID,%Player)
{
	Cancel(%Player.Copymap1306);//先清除倒计时
	%Player.Copymap1306 = Schedule(2000,0,"SptCopymap_OnEnter_1306_Trigger_A",%CopyMapID,%Player);
}
function SptCopymap_OnEnter_1306_Trigger_A(%CopyMapID,%Player)
{
	%Act4016[0] = getact(%player,4016,0) * 1;
	%Act4016[1] = getact(%player,4016,1) * 1;
	%Act4016[0]++;
	SetAct(%player,4016,%Act4016[0],%Act4016[1]);
}
//■■■■【诛神问心阵】■■■■【玩家进入副本】■■■■■■■


//■■■■【诛神问心阵】■■■■【怪物刷新函数】■■■■■■■
function CanSptCreatemonster(%CopyMapID,%Player,%Guaqia)//判断当前关卡的怪死干净了没
{
	if ($MonsterRecordNumber[%CopyMapID] > 0)
		return -1;
	for (%i=1; %i<=24; %i++)
	{
		if ($MonsterRecord[%CopyMapID,%i].GetDamageState() $= "Enabled")
			return 0;
	}
	return 1;
}
function SptCreatemonster(%CopyMapID,%Player,%Guaqia)
{
	%Count = 14 + %Guaqia;
	$MonsterRecordNumber[%CopyMapID] = %Count;
	for (%i=1; %i<= %Count; %i++)
	{
		%NpcID = getword($MonsterRecord[%i],0,";");
		%Pos = getword($MonsterRecord[%i],1,";");
		%rot = getword($MonsterRecord[%i],2,";");
		%sacle = getword($MonsterRecord[%i],3,";");
		%hatelink = getword($MonsterRecord[%i],4,";");

		$MonsterRecord[%CopyMapID,%i] = SpNewNpc3(0,%NpcID,%Pos,%CopyMapID,%rot,%sacle);
		$MonsterRecord[%CopyMapID,%i].SetHateLinkId(%hatelink);
		$MonsterRecord[%CopyMapID,%i].setlevel(%player.getlevel());

		if (%i >= 15 && %i <= 23)//心魔特殊处理
		{
			//switch ( %Player.GetClasses( 0 ) )
			//{
			//	case 1:%Skill[ 1 ] = 201020001;//根据职业给予技能 战 1
			//	case 2:%Skill[ 1 ] = 201020001;//根据职业给予技能 
			//	case 3:%Skill[ 1 ] = 201040001;//根据职业给予技能 法 3
			//	case 4:%Skill[ 1 ] = 201030001;//根据职业给予技能 道 4
			//	case 5:%Skill[ 1 ] = 201020001;//根据职业给予技能 
			//}
			//$MonsterRecord[ %CopyMapID, %i ].addskill( %Skill[ 1 ] );
			$MonsterRecord[%CopyMapID,%i].Setshapename(%player.getobjectname());
			$MonsterRecord[%CopyMapID,%i].AddEnemyBuffPercent(%player,10000);//继承属性
			MirrorimagePlayerServer(%Player,$MonsterRecord[%CopyMapID,%i]); //镜像玩家
			//MirrorimagePlayerSql( playerid, %npc );	创建离线玩家 镜像
			//MirrorimagePlayerServer( %palyer, %npc );	创建在线玩家镜像

		}
	}
}
//■■■■【诛神问心阵】■■■■【怪物刷新函数】■■■■■■■


//■■■■【诛神问心阵】■■■■【怪物死亡触发】■■■■■■■
function NpcObjectonDeathcast_413031006(%Monster,%Player){ NpcObjectonDeathcast_413031006_413031001(%Monster,%Player); }//阵卒
function NpcObjectonDeathcast_413031005(%Monster,%Player){ NpcObjectonDeathcast_413031006_413031001(%Monster,%Player); }//车
function NpcObjectonDeathcast_413031004(%Monster,%Player){ NpcObjectonDeathcast_413031006_413031001(%Monster,%Player); }//马
function NpcObjectonDeathcast_413031003(%Monster,%Player){ NpcObjectonDeathcast_413031006_413031001(%Monster,%Player); }//象
function NpcObjectonDeathcast_413031002(%Monster,%Player){ NpcObjectonDeathcast_413031006_413031001(%Monster,%Player); }//仕
function NpcObjectonDeathcast_413031001(%Monster,%Player){ NpcObjectonDeathcast_413031006_413031001(%Monster,%Player); }//将
function NpcObjectonDeathcast_413031007(%Monster,%Player){ NpcObjectonDeathcast_413031006_413031001(%Monster,%Player); }//心魔
function NpcObjectonDeathcast_413031008(%Monster,%Player){ NpcObjectonDeathcast_413031006_413031001(%Monster,%Player); }//阵灵
function NpcObjectonDeathcast_413031006_413031001(%Monster,%Player)
{
	%CopyMapID = %Player.GetLayerId();
	$MonsterRecordNumber[%CopyMapID]--;//总数量减1
	//echo("$MonsterRecordNumber[ %CopyMapID ] =======" @ $MonsterRecordNumber[%CopyMapID]);
	if ($MonsterRecordNumber[%CopyMapID] == 0)
	{
		%Act4016[0] = getact(%player,4016,0) * 1;
		%Act4016[1] = getact(%player,4016,1) * 1;
		%index = CanSptCreatemonster(%CopyMapID,%Player,%Act4016[1]);
		if (%index == 1)
		{
			//echo("===========刷新宝箱===========");
			%Obj = SpNewCj2(%Player,553000003 + %Act4016[1] - 1,0,%CopyMapID,0,"1 1 1");//刷新宝箱

			%Act4016[1]++;
			SetAct(%player,4016,%Act4016[0],%Act4016[1]);
		}
	}
}
//■■■■【诛神问心阵】■■■■【怪物死亡触发】■■■■■■■

//■■■■【诛神问心阵】■■■■【宝箱采集触发】■■■■■■■
function TriggerEvent_553000003(%Player,%Event,%EventID){ TriggerEvent_553000003_553000012(%Player,%Event,%EventID); }//诛神问心阵（关卡一）
function TriggerEvent_553000004(%Player,%Event,%EventID){ TriggerEvent_553000003_553000012(%Player,%Event,%EventID); }//诛神问心阵（关卡二）
function TriggerEvent_553000005(%Player,%Event,%EventID){ TriggerEvent_553000003_553000012(%Player,%Event,%EventID); }//诛神问心阵（关卡三）
function TriggerEvent_553000006(%Player,%Event,%EventID){ TriggerEvent_553000003_553000012(%Player,%Event,%EventID); }//诛神问心阵（关卡四）
function TriggerEvent_553000007(%Player,%Event,%EventID){ TriggerEvent_553000003_553000012(%Player,%Event,%EventID); }//诛神问心阵（关卡五）
function TriggerEvent_553000008(%Player,%Event,%EventID){ TriggerEvent_553000003_553000012(%Player,%Event,%EventID); }//诛神问心阵（关卡六）
function TriggerEvent_553000009(%Player,%Event,%EventID){ TriggerEvent_553000003_553000012(%Player,%Event,%EventID); }//诛神问心阵（关卡七）
function TriggerEvent_553000010(%Player,%Event,%EventID){ TriggerEvent_553000003_553000012(%Player,%Event,%EventID); }//诛神问心阵（关卡八）
function TriggerEvent_553000011(%Player,%Event,%EventID){ TriggerEvent_553000003_553000012(%Player,%Event,%EventID); }//诛神问心阵（关卡九）
function TriggerEvent_553000012(%Player,%Event,%EventID){ TriggerEvent_553000003_553000012(%Player,%Event,%EventID); }//诛神问心阵（关卡十）
function TriggerEvent_553000003_553000012(%Player,%Event,%EventID)
{
	//echo("宝箱采集触发==" @  %EventID);
	for (%i=1; %i<=99; %i++)
	{
		if ($SL_ZhuShenWenXinZhen_Item[%EventID,%i] $= "")
			break;
		%itemID = getword($SL_ZhuShenWenXinZhen_Item[%EventID,%i],0,";");
		%itemnum = getword($SL_ZhuShenWenXinZhen_Item[%EventID,%i],1,";");
		%ran = getword($SL_ZhuShenWenXinZhen_Item[%EventID,%i],2,";");
		%oprate = getword($SL_ZhuShenWenXinZhen_Item[%EventID,%i],3,";");
		%msg = getword($SL_ZhuShenWenXinZhen_Item[%EventID,%i],4,";");
		if (%ran >= getrandom(1,10000) && %itemID > 0)
		{
			%index = %Player.PutItem(%itemID,%itemnum);
			if (%oprate  == 1)
				%Player.SetPutItemProperty(%index,1,%Player.GetPlayerID());
			if (%Player.AddItem(4,%EventID))
			{
				if (%msg >= 1)
				{
					%text = "<l i='"@ %Player.GetPlayerName() @ " "@ %Player.GetPlayerID() @ "' t='name' />" @ "<t>从</t>" @ $Get_Dialog_GeShi[31422] @ "『诛神问心阵』</t><t>获得了</t>" @ "<l i='" @ %itemid @ " ' t='itemid'/>" @ "<t>,羡煞了众修士。</t>";
					SendOneLineMessage($Get_Dialog_GeShi[31419] @ %Text @ "</t>");
				}
			}
		}
	}
	%Event.safedeleteobject();
	return true;
}

//■■■■【诛神问心阵】■■■■【宝箱采集触发】■■■■■■■